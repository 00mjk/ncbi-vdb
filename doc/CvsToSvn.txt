# (2) In a checkout of https://svn.ncbi.nlm.nih.gov/repos/misc_projects/production/components/sra_sdk
#    create a subdirectory corresponding to the tag's version (e.g. 2.3.3) containing a src directory consisting of a copy of the
#    checkout from step (1).  NB: A full checkout of this tree takes a
#    little over 1 GiB at present, so you might want to use svn's
#    "--depth empty" flag.
cd /panfs/pan1.be-md.ncbi.nlm.nih.gov/sra-test/boshkina
svn co https://svn.ncbi.nlm.nih.gov/repos/misc_projects/production/components/sra_sdk --depth empty

# (1) Run cvs export to obain a checkout of the relevant tag with no "CVS" directories.
mkdir -p sra_sdk/2.3.3/src
cd sra_sdk/2.3.3
cvs export -r sratoolkit_2_3_3 -d src internal/asm-trace 

#(3) Trim unwanted portions of this tree:
#    autobuild
#    build/MSVC/align_dll/zlib-1.2.5
#    interfaces/ext/{hdf5,libxml,*z*}
#    rhosts
#    scm
#    services
#    trace-old
cd src
rm -rf autobuild build/MSVC build/Xcode doc interfaces/ext/hdf5 interfaces/ext/libxml interfaces/ext/*z* java rhosts scm services trace-old test/services
###### try interfaces/ext  instead of interfaces/ext/* 

# (5) Run svn add on the top-level directory from (2).
# (svn might complain about Windows end-of-lines)

cp ~/internal/asm-trace/libs/kns/nih_1_out.txt libs/kns

cd ../..
svn add 2.3.3

#(6) Use the attached make-no-props script (to be run from .../src) to
#    identify files that didn't automatically receive svn:mime-type
#    metadata.  (We should perhaps adjust our repository configuration to
#    recognize more of these.)
#attachment:
##!/bin/sh
#comm -23 <(find .[!s]?* * -name .svn -prune -o -type f -print | sort) <(svn pg -R svn:mime-type | sed -e 's/ - .*//' | sort) > ../no-props
cd 2.3.3/src
comm -23 <(find .[!s]?* * -name .svn -prune -o -type f -print | sort) <(svn pg -R svn:mime-type | sed -e 's/ - .*//' | sort) > ../no-props

#(7) Use the attached add-props script (likewise run from .../src) to
#    assign svn:mime-type (along with svn:eol-style for files with text/*
#    types).
#attachment:
#!/bin/sh
#egrep -v '\.[ly]$|\.lp[ir]$|\.pas$|\.perl$|\.svg$' ../no-props | xargs svn -q ps svn:mime-type text/plain
#grep  '\.l$'          ../no-props | xargs svn ps svn:mime-type text/x-lex
#grep  '\.lpi$'        ../no-props | xargs svn ps svn:mime-type application/xml
#egrep '\.lpr$|\.pas$' ../no-props | xargs svn ps svn:mime-type text/x-pascal
#grep  '\.perl$'       ../no-props | xargs svn ps svn:mime-type text/x-perl
#grep  '\.svg$'        ../no-props | xargs svn ps svn:mime-type image/svg+xml
#grep  '\.y$'          ../no-props | xargs svn ps svn:mime-type text/x-yacc
#egrep -v '\.lpi$|\.svg$' ../no-props | xargs svn -q ps svn:eol-style native
#
#svn ps svn:keywords Id libs/kfs/kfsmagic

egrep -v '\.[ly]$|\.lp[ir]$|\.pas$|\.perl$|\.svg$' ../no-props | xargs svn ps svn:mime-type text/plain
grep  '\.l$'          ../no-props | xargs svn ps svn:mime-type text/x-lex
grep  '\.lpi$'        ../no-props | xargs svn ps svn:mime-type application/xml
egrep '\.lpr$|\.pas$' ../no-props | xargs svn ps svn:mime-type text/x-pascal
grep  '\.perl$'       ../no-props | xargs svn ps svn:mime-type text/x-perl
grep  '\.svg$'        ../no-props | xargs svn ps svn:mime-type image/svg+xml
grep  '\.y$'          ../no-props | xargs svn ps svn:mime-type text/x-yacc
egrep -v '\.lpi$|\.svg$' ../no-props | xargs svn ps svn:eol-style native
svn ps svn:keywords Id libs/kfs/kfsmagic

# (8) Run svn commit on the top-level directory from (2).
cd ../..
svn commit 2.3.3 -m"sra toolkit 2.3.3"
#time: ~20 minutes

#(9) If you don't already have one, obtain a checkout of the C++ Toolkit's
#    trunk by running "svn_toolkit_tree trunk mydirname".  All further
#    steps will take place here.
